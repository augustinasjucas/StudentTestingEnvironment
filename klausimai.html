<html>
<style>
	.AllQuestionsHolder{
		width: 70%;
	}
	.MainTable, .MainTable th, td{
		border: 1px solid black;
	}
	.RemoveQuestion .ChangeQuestion{
		width: 10px;
	}
</style>
<script src="http://code.jquery.com/jquery-latest.min.js"></script>
<script src="/socket.io/socket.io.js"></script>
<h1 class="MainName">Klausimu duomenu baze</h1>
<div class="AllQuestions" id="AllQuestionsHolder"></div>
<script>
	const EditQuestion = 'Redaguoti klausimą';
	const Unspecified = 'Nenurodytas';
	const Question = 'Klausimas';
	const ChoosingOptions = 'Pasirinkimo variantai';
	const Answer = 'Atsakymas';
	const Functions = 'Funkcijos';
	const ToUpdateQuestion = 'Redaguoti klausimą';
	const ToRemoveQuestion = 'Panaikinti klausimą';
	var AllQuestions = [];
	
	var socket = io.connect();
	socket.emit('AskForQuestions');
	socket.on('GetAllQuestions', function(data){
		AllQuestions = data;
		console.log(data);
		LoadAllQuestions();
	});
	function GetAnswer(answer, index){
		if(answer == '' && AllQuestions[index].Type == 'Open') return Unspecified;
		if(answer != '' && AllQuestions[index].Type == 'Open') return answer;
		return answer+1;
	}
	function CreateButton(id, clas, onClick, value){
		var Button = document.createElement('button');
		Button.setAttribute('id', id);
		Button.setAttribute('class', clas);
		Button.setAttribute('onClick', onClick);
		Button.innerHTML = value;
		return Button;
	}
	function CreateTr(id, clas){
		var Tr = document.createElement('tr');
		Tr.setAttribute('id', id);
		Tr.setAttribute('class', clas);
		return Tr;
	}
	function CreateTd(id, clas, value){
		var Td = document.createElement('td');
		Td.setAttribute('id', id);
		Td.setAttribute('class', clas);
		Td.innerHTML = value;
		return Td;
	}
	function CreateDiv(id, clas, value){
		var Div = document.createElement('div');
		Div.setAttribute('id', id);
		Div.setAttribute('class', clas);
		Div.innerHTML = value;
		return Div;
	}
	function CreateBr(){
		var Br = document.createElement('br');
		return Br;
	}
	
	function CreateOptionsField(options, index){
		var Return = CreateTd('OptionsField'+index, 'OptionField', '');
		console.log(options);
		for(var i = 0; i < options.length; i++){
			var Div = CreateDiv('', '', (i+1) + ') ' + options[i]);
			if(i != options.length-1) Div.append(CreateBr());
			Return.append(Div);
		}
		return Return;
	}
	function CreateAnswerField(answer, index){
		var Td = CreateTd('AnswerField'+index, 'AnswerField', GetAnswer(answer, index));
		return Td;
	}
	
	function CreateFunctionsField(index){
		var Td = CreateTd('FunctionsField'+index, 'FunctionsField', '');
		Td.append(CreateButton('ChangeQuestion'+index, 'ChangeQuestion', 'ChangeQuestion('+index+')', ToUpdateQuestion));
		Td.append(CreateBr());
		Td.append(CreateButton('RemoveQuestion'+index, 'RemoveQuestion', 'RemoveQuestion('+index+')', ToRemoveQuestion));
		
		return Td;
	}
	
	function CreateOpen(question, index){
		var Tr = CreateTr('QuestionRow'+index, 'QuestionRow Open');
		
		var QuestionField = CreateTd('QuestionField'+index, 'QuestionField', question.Question);
		var OptionsField = CreateOptionsField(question.Options, index);
		var AnswerField = CreateAnswerField(question.Answer, index);
		var FunctionsField = CreateFunctionsField(index);
		
		Tr.append(QuestionField);
		Tr.append(OptionsField);
		Tr.append(AnswerField);
		Tr.append(FunctionsField);
		return Tr;
	}
	function CreateTable(id, clas, headers){
		var Table = document.createElement('table');
		Table.setAttribute('id', id);
		Table.setAttribute('class', clas);
		
		var tr = CreateTr('TableHeaders', 'TableHeaders');
		
		for(var i = 0; i < headers.length; i++){
			var th = document.createElement('th');
			th.innerHTML = headers[i];
			tr.append(th);
		}
		Table.append(tr);
		return Table;
	}
	function LoadAllQuestions(){
		
		var Holder = document.getElementById('AllQuestionsHolder');
		var MainTable = CreateTable('MainTable', 'MainTable', [Question, ChoosingOptions, Answer, Functions]);
		
		Holder.append(MainTable);
		for(var i = 0; i < AllQuestions.length; i++){
			if(AllQuestions[i].Type == 'Closed') MainTable.append(CreateOpen(AllQuestions[i], i));
		}
	}
</script>

</html>
